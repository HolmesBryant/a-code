class t extends HTMLElement{#t;#e=!1;#o;#i=!1;#r;#s="input";#n;#l="value";#a;#c=!1;#h;#u=!1;#d=!1;#b=!1;abortController;elem;model;hasUpdated=!1;static observedAttributes=["o","object","p","property","e","event","a","attribute","f","func","oa","object-attribute","oneway","once"];constructor(){super(),window.abind||(window.abind=t)}attributeChangedCallback(t,e,o){this[t]=o}async connectedCallback(){if(!this.object)return console.error('a-bind requires an object to bind to: object="..." or o=""...');if(this.elem=this.children[0],!this.elem)return console.error("a-bind element must have one child which is an HTML element",this);if(this.model=await this.getModel(this.object),!this.model)return;this.abortController=new AbortController;const t=this.attribute.split(/[,\s]+/);for(const e of t)this.setElemAttr(e.trim());this.addElemListeners()}disconnectedCallback(){this.abortController&&(this.abortController.abort(),this.abortController=null)}addElemListeners(){if(!this.property in this.model&&!this.property.startsWith("--"))return console.error(`${Object.prototype.toString.call(object)} does not have property ${property}`);this.elem.addEventListener(this.event,(t=>{t.preventDefault(),this.doEvent(t)}),{signal:this.abortController.signal}),document.addEventListener("abind",(t=>{if(this.model!==t.detail.obj)return;if(this.property!==t.detail.prop)return;if(this.objectAttribute&&void 0!==this.model.constructor.observedAttributes&&-1===this.model.constructor.observedAttributes.indexOf(this.objectAttribute))return;if(this.once&&this.hasUpdated)return;const e=this.attribute.split(",");for(let o of e)o=o.trim(),this.setElemAttr(o,t.detail.value);this.hasUpdated=!0}),{signal:this.abortController.signal})}doEvent(t){let e,o,i,r;const s=this.model,n=this.property,l=this.elem,a=this.attribute;if(n&&n.startsWith("--"))s.style.setProperty(n,l[a]);else if("select"===l.localName&&l.hasAttribute("multiple"))s[n]=Array.from(l.selectedOptions).map((t=>t.value));else if("checkbox"===l.type)s[n]=l.checked?l[a]:"";else if(n&&n.indexOf(".")>-1){e=n.split("."),i=e.shift();for(const t of e)void 0!==s[t]&&(i=i[t])}else s[n]=l[a];if(this.func){const t=this.func.split(":");let e=t.shift();if(t.push(l[a]),e.indexOf(".")>-1&&(o=e.split("."),e=o.shift()),void 0===s[e]&&void 0===window[e]){const t=s.localName||Object.prototype.toString.call(s);return console.error(`${t} does not have function: ${e}`)}if(o){window[e]&&(r=window[e]);for(const t of o)void 0!==r[t]&&(r=r[t]);r(...t)}else window[e]?window[e](...t):s[e].call(s,...t)}}setElemAttr(t,e){if(!this.oneway&&this.elem[t]!==e){if(this.property&&this.property.startsWith("--")&&this.model instanceof HTMLElement){e=getComputedStyle(this.model).getPropertyValue(this.property)}else if(this.property&&this.property.indexOf(!1)){let t;const o=this.property.split(".");for(const e of o)void 0!==this.model[e]&&(t=this.model[e]);e=t}else e=this.objectAttribute?this.model.getAttribute?this.model.getAttribute(this.objectAttribute):"":e||this.model[this.property];switch(this.elem.localName){case"input":if("checkbox"===this.elem.type){this.elem.checked=this.elem.value===e.toString();break}if("radio"===this.elem.type){this.elem.checked=this.elem.value==e.toString();break}if("file"===this.elem.type)return;void 0!==e&&(this.elem[t]=e);break;case"select":if(this.elem.hasAttribute("multiple"))try{const t=Array.isArray(this.model[this.property])?this.model[this.property]:this.model[this.property].split(/[,\s]+/);for(const e of this.elem.options)e.selected=t.indexOf(e.value)>-1}catch(t){console.error(`Error: ${this.object}:${this.property}, ${this.attribute}:${e}`,t)}else void 0!==e&&(this.elem[t]=e);break;default:if(t.startsWith("style.")){const o=t.split(".").pop();this.elem.style[o]=e}else void 0!==e&&(this.elem[t]=e)}}}static update(t,e,o){const i=new CustomEvent("abind",{detail:{obj:t,prop:e,value:o}});document.dispatchEvent(i)}async getModel(t,e=1){let o,i="";if(t.startsWith("#")){const e=document.querySelector(t);if(!e)throw new Error(`${t} not found`);e instanceof HTMLElement&&(o=e.localName),i=t}else o=t;return new Promise((r=>{const s=setTimeout((()=>{console.error(`Timeout: ${t} not found.`),r(null)}),1e3*e);window[o]?(clearTimeout(s),r(window[o])):customElements.get(o)?(clearTimeout(s),r(document.querySelector(o+i))):customElements.whenDefined(o).then((()=>{clearTimeout(s),r(document.querySelector(o+i))})).catch((t=>{clearTimeout(s),console.error(`Error: ${o} ${i} is not a valid javascript object, function or custom element`),r(null)}))}))}get o(){return this.#e}set o(t){this.#e=t}get object(){return this.#e}set object(t){this.#e=t}get p(){return this.#i}set p(t){this.#i=t}get property(){return this.#i}set property(t){this.#i=t}get e(){return this.#s}set e(t){this.#s=t}get event(){return this.#s}set event(t){this.#s=t}get a(){return this.#l}set a(t){this.#l=t}get attribute(){return this.#l}set attribute(t){this.#l=t}get f(){return this.#u}set f(t){this.#u=t}get func(){return this.#u}set func(t){this.#u=t}get oa(){return this.#c}set oa(t){this.objectAttribute=t}get objectAttribute(){return this.#c}set objectAttribute(t){/[\p{Lu}]/u.test(t)&&console.warn("An item binds to an object attribute but the value contains upper case characters. Attribute names are normally lower-kebab-case. Make sure you are binding to an attribute instead of a property:",t,this),this.#c=t}get oneway(){return this.#d}set oneway(t){t="false"!==t&&!1!==t,this.#d=t}get once(){return this.#b}set once(t){t=!1!==t&&"false"!==t,this.#b=t}}document.addEventListener("DOMContentLoaded",(()=>{customElements.get("a-bind")||customElements.define("a-bind",t)}));export{t as default};
