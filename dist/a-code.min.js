/**
  * @author Holmes Bryant <https://github.com/HolmesBryant>
  * @license GPL-3.0
  * @version 2.0.1
  */
class t extends HTMLElement{#t=!1;#e=!1;#i=!1;#s=4;#n=!1;#h=null;#r="pre";#l;contentNode;#o=null;#a=Date.now();lineNumberElem;#d;#g;highlighter;defaults={};static observedAttributes=["highlight","inline","indent","line-numbers","palette","wrap"];static template=document.createElement("template");static{this.template.innerHTML='\n    <style>\n      :host {\n        --indent: 2;\n        --line-number-color: gray;\n        --wrap: pre;\n        display: block;\n        max-width: 100%;\n        vertical-align: top;\n      }\n\n      :host([inline]) {\n        display: inline-block;\n        padding: 0;\n      }\n\n      section {\n        display: inline-grid;\n        gap: .5rem;\n        grid-template-columns: max-content 1fr;\n        width: 100%;\n      }\n\n      #content {\n        font-family: "Courier New", monospace;\n        tab-size: var(--indent);\n        white-space: var(--wrap);\n        overflow: auto;\n      }\n\n      #line-numbers {\n        color: var(--line-number-color);\n        font-family: "Courier New", monospace;\n        white-space: pre-line;\n      }\n    </style>\n\n    <section part="section">\n      <div id="line-numbers" part="line-numbers"></div>\n      <div id="content" part="content"><slot></slot></div>\n    </section>\n  '}constructor(){super(),this.attachShadow({mode:"open"})}attributeChangedCallback(t,e,i){switch(t){case"highlight":this.#c(i);break;case"inline":i=null!==i&&"false"!==i&&!1!==i,this.#u(i);break;case"indent":this.style.setProperty("--indent",i),this.#s=i,window.abind&&abind.update(this,"indent",i);break;case"line-numbers":this.#p(i);break;case"palette":this.#h=i;break;case"wrap":this.#r=i,this.style.setProperty("--wrap",i)}}connectedCallback(){this.shadowRoot.append(t.template.content.cloneNode(!0)),this.contentNode=this.shadowRoot.querySelector("#content"),this.lineNumberElem=this.shadowRoot.querySelector("#line-numbers"),this.#l=new AbortController,this.#d=new MutationObserver(this.#b.bind(this));const e=this.#m(this.#f());this.textContent=e,this.#o=e,this.lineNumbers&&this.#y(),this.highlight&&this.#w(),this.#S(),this.#d.observe(this,{childList:!0,subtree:!0,characterData:!0})}disconnectedCallback(){this.#l&&(this.#l.abort(),this.#l=null),this.#d&&(this.#d.disconnect(),this.#d=null),this.#N(),this.highlighter=null,this.#h=null,this.contentNode=null,this.lineNumberElem=null}#y(){if(!this.lineNumberElem)return;const t=this.textContent.split(/\r?\n/).length;let e="";for(let i=1;i<=t;i++)e+=`${i}\n`;this.lineNumberElem.innerHTML=e.trim()}#C(t){const e=document.createElement("textarea");return e.innerHTML=t,e.value}#N(){if(this.highlighter)try{this.highlighter.destroy()}catch(t){console.error(t)}}#b(t=250){clearTimeout(this.#g),this.#g=setTimeout((()=>this.#x()),t)}#f(){return this.children[0]&&"textarea"===this.children[0].localName?this.textContent.replace("\\/","/"):this.#C(this.innerHTML)}#w(t=this.highlight,e=this.palette){if(!1!==t){this.highlighter=new i(this,t,e);try{this.highlighter.highlight(this.childNodes[0])}catch(t){throw t}}}#v(){this.lineNumberElem&&(this.lineNumberElem.innerHTML="")}reset(){for(const t of ABind.observedAttributes)this[t]=this.defaults[t]}#m(t){this.needsUpdate=!1,t=t.replace(/^ +/gm,(t=>"\t".repeat(t.length))).trim();const e=t.split("\n"),i=e.at(-1).match(/^\s*/)[0].length,s=new RegExp(`^\\s{${i}}`,"g");return e.map((t=>t.replace(s,""))).join("\n")}#S(){if(!(Object.keys(this.defaults).length>0))for(const e of t.observedAttributes)this.defaults[e]=this[e]}#c(t){switch(t){case"false":case!1:this.#e=!1,this.highlighter&&this.highlighter.deleteCssHighlights();break;case"":case null:this.#e="html";break;default:this.#e=t}!1!==this.#e&&this.highlighter&&this.highlighter.setHighlights(t),window.abind&&abind.update(this,"highlight",t)}#u(t){!0===t?(this.style.setProperty("--wrap","nowrap"),this.lineNumbers=!1):(this.style.removeProperty("--wrap"),this.hasAttribute("line-numbers")&&(this.lineNumbers=this.getAttribute("line-numbers"))),this.#i=t,window.abind&&abind.update(this,"inline",t)}#p(t){t=null!==t&&"false"!==t&&!1!==t,this.#n=t,!0===t?this.#y():this.#v(),window.abind&&abind.update(this,"lineNumbers",t)}#x(){const t=this.#m(this.#f());t!==this.#o&&(this.#o=t,this.textContent=t,this.highlighter&&this.#N(),this.lineNumbers&&this.#y(),this.highlight&&requestAnimationFrame((()=>this.#w())))}get abortController(){return this.#l}get observer(){return this.#d}get inline(){return this.#i}set inline(t){t=""!==t&&"false"!==t&&!1!==t,this.toggleAttribute("inline",t)}get indent(){return this.#s}set indent(t){t||(t=this.defaults.indent),this.setAttribute("indent",t)}get highlight(){return this.#e}set highlight(t){t||(t=this.defaults.highlight),this.setAttribute("highlight",t)}get lineNumbers(){return this.#n}set lineNumbers(t){t=null!==t&&"false"!==t&&!1!==t,this.toggleAttribute("line-numbers",t)}get palette(){return this.#h}set palette(t){console.log("value",t),this.setAttribute("palette",JSON.stringify(t))}get wrap(){return this.#r}set wrap(t){this.setAttribute("wrap",t)}}const e=new Map;class i{#E=null;#H;#T={argument:/(?<=\()[^)]+/g,function:/[\w-]+\s*\(|\)/g,operator:/[>+~*\/=]|(?<!\w[-])/g,property:/(?<!}[\r\n\s]+)\b([\w\d-]+:(?!:))/g,number:/(?<!\w)[#+-.]?\d+[%.A-Za-z]*/g,tag:/<\/?[\w-]+|(?<=[\w"'])>/g,string:/["'`][^"'`]*["'`]/g,variable:/--[\w\d]+-?[\w\d]*/g,comment:/(<!--|\/\*)([\s\S]*?)(-->|\*\/)/g,keyword:/@[\w]+\b/g};#k;#h;#L=new Map([["argument","hsl(32, 93%, 66%)"],["comment","hsl(221, 12%, 69%)"],["function","hsl(210, 50%, 60%)"],["keyword","deeppink"],["number","hsl(32, 93%, 50%)"],["operator","red"],["property","orchid"],["string","hsl(114, 31%, 68%)"],["variable","darkkhaki"],["tag","indianred"]]);#A;#M;constructor(t,e,i,s){if(!(t instanceof HTMLElement))throw new Error("element passed to Highlighter must be an HTML element");this.#E=e||this.#E,this.#h=null!==i&&"default"!==i?i:this.#L,this.#k=s||Math.random().toString(36).substring(2,9),this.#A=this.#$();(t.shadowRoot&&"open"===t.shadowRoot.mode?t.shadowRoot:t.attachShadow({mode:"open"})).adoptedStyleSheets=[this.#A],document.adoptedStyleSheets=[...document.adoptedStyleSheets,this.#A]}#$(){const t=this.#A?this.#A:new CSSStyleSheet;let e="";return this.#h.forEach(((t,i)=>{const s=`${i}-${this.#k}`;e+=`::highlight(${s}) { color: ${t}}`})),t.replaceSync(e),t}deleteCssHighlights(){for(const t of Object.keys(this.#H)){const e=`${t}-${this.#k}`;CSS.highlights.delete(e)}}destroy(){this.deleteCssHighlights(),document.adoptedStyleSheets=document.adoptedStyleSheets.filter((t=>t!==this.#A))}#R(t,e){if(e.nodeType!==Node.TEXT_NODE)throw new Error(`Second argument must be a TEXT_NODE (3). Given nodeType is (${e.nodeType})`);let i;const s=e.textContent;for(const n of Object.keys(t)){const h=t[n];if(h){if(Array.isArray(h)){const t=[...new Set(h)].join("|"),n=new RegExp(`\\b(${t})\\b`,"g");i=this.#D(n,s,e)}else if(h instanceof Function)i=new Set(h(s,e));else{if(!(h instanceof RegExp)){console.error(`Invalid syntaxObj definition for ${n}: `,`"${h}"`);continue}i=this.#D(h,s,e)}this.#c(i,n)}}return CSS.highlights.size}async#O(t){let i;if("string"==typeof t)if(e.has(t))i=e.get(t);else{let s=t;/^(http|\.|\/)/.test(t)||(s=`./syntax.${t}.js`);try{const n=await import(s);e.set(t,n.default),i=n.default}catch(t){throw console.error("Error loading Highlight Syntax"),t}}else try{i=t,e.set(t,t)}catch(s){i=this.defaultSyntaxDefs,e.set(t,i),console.error("Error loading syntax definition. Using defaults: ",s)}return i}async highlight(t){t&&t.nodeType!==Node.TEXT_NODE&&(t=document.createTextNode(t.textContent)),t=t||this.#M,this.#M||(this.#M=t),this.#E&&"html"!==this.#E?this.#H=await this.#O(this.#E):this.#H=this.#T;try{this.#R(this.#H,t)}catch(t){throw console.error("Error highlighting code: "),t}}#c(t,e){const i=`${e}-${this.#k}`,s=new Highlight(...t);CSS.highlights.set(i,s)}setHighlights(t){this.deleteCssHighlights(),this.#E=t,this.highlight()}setPalette(t){if(t instanceof Map&&0===t.size)t=this.#L;else if(!(t instanceof Map))try{const e=JSON.parse(t);t=new Map(e)}catch(e){return console.error(`Error setting palette: ${e}`,t)}this.#h=t,this.#$()}#D(t,e,i){const s=new Set,n=e.matchAll(t);for(const t of n){if(0===t[0].length)continue;const e=t.index,n=e+t[0].length,h=new Range;h.setStart(i,e),h.setEnd(i,n),s.add(h)}return s}}customElements.get("a-code")||customElements.define("a-code",t);export{t as ACode,i as Highlighter};
